<!DOCTYPE html>
<html lang="en">

<head>
    <title>IGME 430 Project 1 Documentation</title>
    <link rel="stylesheet" type="text/css" href="/style.css">

    <script>

        //Handles the response async. Parses the JSON if the method is not a HEAD
        const handleResponse = async (response) => {
            const message = document.querySelector('#message');
            switch (response.status) {
                case 200: //success
                    message.innerHTML = `<b>Success!</b>`;
                    break;
                case 201: //created
                    message.innerHTML = '<b>Created</b>';
                    break;
                case 204: //updated (no response back from server)
                    message.innerHTML = '<b>Updated (No Content)</b>';
                    return;
                case 400: //bad request
                    message.innerHTML = `<b>Bad Request</b>`;
                    break;
                default: //any other status code - 404
                    message.innerHTML = `<b>Not Found</b>`;
                    break;
            }

            const content = document.querySelector('#content');

            //Returns early if the method is a head
            //so that the body is not parsed
            if (response.method === "HEAD") {
                content.innerHTML = "";
                return;
            }

            const obj = await response.json();

            content.innerHTML = "";

            //If we have a message, display it.
            if (obj.message) {
                content.innerHTML += `<p>${"Message: " + obj.message}</p>`;
            }

            //If it is a success, set the innerHTML to the obj users
            if (response.status === 200) {
                content.innerHTML += JSON.stringify(obj);
            }

            console.log(obj);
        };

        const sendPost = async (api) => {
            let url = '';
            let method = 'POST';
            let formData = '';

            switch (api) {
                case 'addCountry':
                    const name = document.querySelector('#name_addCountry').value;
                    const capital = document.querySelector('#capital_addCountry').value;
                    const currency = document.querySelector('#currency_addCountry').value;
                    const currencyName = document.querySelector('#currencyName_addCountry').value;
                    const currencySymbol = document.querySelector('#currencySymbol_addCountry').value;
                    const region = document.querySelector('#region_addCountry').value;
                    const subregion = document.querySelector('#subregion_addCountry').value;
                    const nationality = document.querySelector('#nationality_addCountry').value;
                    const zoneName = document.querySelector('#zoneName_addCountry').value;
                    const gmtOffset = document.querySelector('#gmtOffset_addCountry').value;
                    const gmtOffsetName = document.querySelector('#gmtOffsetName_addCountry').value;
                    const abbreviation = document.querySelector('#abbreviation_addCountry').value;
                    const tzName = document.querySelector('#tzName_addCountry').value;
                    const latitude = document.querySelector('#latitude_addCountry').value;
                    const longitude = document.querySelector('#longitude_addCountry').value;

                    const finance = {
                        currency,
                        currency_name: currencyName,
                        currency_symbol: currencySymbol
                    };

                    const timezones = [{
                        zoneName,
                        gmtOffset,
                        gmtOffsetName,
                        abbreviation,
                        tzName
                    }];

                    formData = `name=${name}&capital=${capital}&finance=${JSON.stringify(finance)}&region=${region}&subregion=${subregion}&nationality=${nationality}&timezones=${JSON.stringify(timezones)}&latitude=${latitude}&longitude=${longitude}`;
                    url = '/addCountry';
                    break;
                case 'addReview':
                    const countryName = document.querySelector('#name_addReview').value;
                    const review = document.querySelector('#review_addReview').value;
                    formData = `name=${countryName}&review=${review}`;
                    url = '/addReview';
                    break;
                case 'addFavorite':
                    const favCountry = document.querySelector('#name_addFavorite').value;
                    formData = `name=${favCountry}`;
                    url = '/addFavorites';
                    break;
            }

            let response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Accept': 'application/json',
                },
                body: formData,
            });

            handleResponse(response);
        };

        //Uses fetch to send a getRequest.
        //Specifically only for GET/HEAD, sets a method in the response
        //so that if it is a HEAD, the body is not parsed
        const sendGet = async (endpoint) => {
            let url = '';
            let method = '';

            switch (endpoint) {
                case 'getCountry':
                    const name = document.querySelector('#name_getCountry').value;
                    method = document.querySelector('input[name="method_getCountry"]:checked').value;
                    url = `/getCountry?name=${name}`;
                    break;
                case 'getCountries':
                    const latmin = document.querySelector('#latmin_getCountries').value;
                    const latmax = document.querySelector('#latmax_getCountries').value;
                    const longmin = document.querySelector('#longmin_getCountries').value;
                    const longmax = document.querySelector('#longmax_getCountries').value;
                    method = document.querySelector('input[name="method_getCountries"]:checked').value;
                    url = `/getCountries?latmin=${latmin}&latmax=${latmax}&longmin=${longmin}&longmax=${longmax}`;
                    break;
                case 'getAllCountries':
                    method = document.querySelector('input[name="method_getAllCountries"]:checked').value;
                    url = `/getAllCountries`;
                    break;
                case 'getRegion':
                    const region = document.querySelector('#region_getRegion').value;
                    const subregion = document.querySelector('#subregion_getRegion').value;
                    method = document.querySelector('input[name="method_getRegion"]:checked').value;
                    url = `/getRegion?region=${region}&subregion=${subregion}`;
                    break;
                case 'getFavorites':
                    method = document.querySelector('input[name="method_getFavorites"]:checked').value;
                    url = `/getFavorites`;
                    break;
            }

            let response = await fetch(url, { method: method });
            response.method = method;
            handleResponse(response);
        };


        //Sets up the event listeners for all of the UI
        const init = () => {
            const apiSelection = document.querySelector('#apiSelection');
            apiSelection.addEventListener('change', showOptions);
            showOptions();
        };

        const showOptions = () => {
            // Hide all divs first
            const divs = document.querySelectorAll('.expandable');
            divs.forEach(div => div.style.display = 'none');

            // Get the selected option
            const selection = document.getElementById('apiSelection').value;

            // Show the associated div if an option is selected
            if (selection) {
                const selectedDiv = document.getElementById(selection);
                selectedDiv.style.display = 'block';
            }
        }

        window.onload = init;

    </script>

</head>

<body>

    <h1>Countries API Documentation</h1>

    <a href="/">Homepage</a>
    <br>

    <select id="apiSelection">
        <option value="getCountry">getCountry</option>
        <option value="getCountries">getCountries</option>
        <option value="getAllCountries">getAllCountries</option>
        <option value="getRegion">getRegion</option>
        <option value="getFavorites">getFavorites</option>
        <option value="addCountry">addCountry</option>
        <option value="addReview">addReview</option>
        <option value="addFavorite">addFavorite</option>
    </select>

    <div id="getCountry" class="expandable">
        <h3>getCountry</h3>
        <br>
        <ul> Query Params:
            <li>Country Name: The name of the country</li>
        </ul>
        <br>
        <p>Returns: A JSON object of country info</p>
        <br>
        <ul> Example:
            <li>Request: /getCountry?name=Canada</li>
            <li>Result: {"name":"Canada","capital":"Ottawa","finance":{"currency":"CAD","currency_name":"Canadian dollar","currency_symbol":"$"}.....}</li>
        </ul>
    </div>
    <div id="getCountries" class="expandable">
        <h3>getCountries</h3>
        <br>
        <ul> Query Params:
            <li>Latitude Min: The minimum latitude float value</li>
            <li>Latitude Max: The maximum latitude float value</li>
            <li>Longitude Min: The minimum longitude float value</li>
            <li>Longitude Max: The maximum longitude float value</li>
        </ul>
        <br>
        <p>Returns: An array of JSON objects of countries that are within the lat and long min and max ranges</p>
        <br>
        <ul> Example:
            <li>Request: /getCountries?latmin=1.0&latmax=10.0&longmin=3.0&longmax=39.9</li>
            <li>Result: [{"name":"Benin","capital":"Porto-Novo","finance":{"currency":"XOF","currency_name":"West African CFA franc".....}}]</li>
        </ul>
    </div>
    <div id="getAllCountries" class="expandable">
        <h3>getAllCountries</h3>
        <br>
        <p>Returns: A JSON object of an array of all JSON country data</p>
        <br>
        <ul> Example:
            <li>Request: /getAllCountries</li>
            <li>Result: {"data":[{"name":"Afghanistan","capital":"Kabul","finance":{"currency":"AFN","currency_name":"Afghan afghani","currency_symbol":"Ø‹"}.....}}</li>
        </ul>
    </div>
    <div id="getRegion" class="expandable">
        <h3>getRegion</h3>
        <br>
        <ul> Query Params:
            <li>Region Name: The name of a region in the world</li>
            <li>Subregion Name: The name of a subregion in the world</li>
        </ul>
        <br>
        <p>Returns: A array of JSON objects of countries that are within the region or subregion. You can only input a region or a subregion, neither or both are not allowed.</p>
        <br>
        <ul> Example:
            <li>Request: /getRegion?region=Americas</li>
            <li>Result: [{"name":"Anguilla","capital":"The Valley","finance":{"currency":"XCD","currency_name":"East Caribbean dollar","currency_symbol":"$"}.....}]</li>
        </ul>
    </div>
    <div id="getFavorites" class="expandable">
        <h3>getFavorites</h3>
        <br>
        <p>Returns: An object with the array of JSON objects of countries you added to your favorite list</p>
        <br>
        <ul> Example:
            <li>Request: /getFavorites</li>
            <li>Result: {"favorites":[{"name":"Canada","capital":"Ottawa","finance":{"currency":"CAD","currency_name":"Canadian dollar".....}}}</li>
        </ul>
    </div>
    <div id="addCountry" class="expandable">
        <h3>addCountry</h3>
        <br>
        <ul> Query Params:
            <li>Name: Name of country</li>
            <li>Capital: Capital of the country</li>
            <li>Currency: The currency acronym</li>
            <li>Currency Name: The name of the currency</li>
            <li>Currency Symbol: The symbol of the currency</li>
            <li>Region: What continent this country is in</li>
            <li>Subregion: What part of the region the country is in</li>
            <li>Nationality: The main nationality of the country</li>
            <li>Zone Name: Name of the zone</li>
            <li>GMT Offset: Number of the offset</li>
            <li>GMT Offset Name: The name of the offset</li>
            <li>Abbreviation: The abbreviation of the zone</li>
            <li>Timezone Name: Name of the timezone</li>
            <li>Latitude: Latitude location of the country</li>
            <li>Longitude: Longitude location of the country</li>
        </ul>
        <br>
        <p>Purpose: Adds or updates a country info with the provided info.</p>
        <br>
        <ul> Example:
            <li>Request: /addCountry?name=e&capital=e&currency=e&currency_name=w&currency_symbol=3&region=3&subregion=23&nationality=djs&zoneName=3&gmtOffset=sss&gmtOffsetName=sss&abbreviation=e&tzName=sjsjs&latitude=1.000&longitude=1.999</li>
            <li>Result: Created successfully!</li>
        </ul>
    </div>
    <div id="addReview" class="expandable">
        <h3>addReview</h3>
        <br>
        <ul> Query Params:
            <li>Country Name: The name of the country</li>
            <li>Review: The name of the country</li>
        </ul>
        <br>
        <p>Purpose: Adds a review to an existing country</p>
        <br>
        <ul> Example:
            <li>Request: /addReview?name=Canada&review="good maple syrup"</li>
            <li>Result: Created successfully!</li>
        </ul>
    </div>
    <div id="addFavorite" class="expandable">
        <h3>addFavorite</h3>
        <br>
        <ul> Query Params:
            <li>Country Name: The name of the country</li>
        </ul>
        <br>
        <p>Purpose: Adds a country to your favorites list</p>
        <br>
        <ul> Example:
            <li>Request: /addFavorite?name=Canada</li>
            <li>Result: Added to favorites</li>
        </ul>
    </div>
</body>

</html>